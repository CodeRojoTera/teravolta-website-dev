# Architecture

> Auto-generated by /map on 2026-01-19

## Overview

Teravolta Website Dev is a Next.js 15 application using the App Router architecture, integrated with Supabase for authentication and database services. It serves as a portal for customers, technicians, and administrators.

```
┌─────────────────────────────────────────┐
│              [Browser/Client]           │
├─────────────────────────────────────────┤
│    [Next.js App Router / Middleware]    │
├─────────────────────────────────────────┤
│      [Supabase Auth & Database]         │
└─────────────────────────────────────────┘
```

## Components

### App Router (`app/`)
- **Purpose:** Handles routing, pages, and API endpoints.
- **Location:** `Development/app`
- **Key Sections:**
    - `portal/`: Authenticated dashboards for `admin`, `customer`, `technician`.
    - `api/`: Backend endpoints (`create-technician`, `send-invoice`, etc.).
    - `services/`: Service pages (`consulting`, `efficiency`).
    - `onboard/`: Technician onboarding flow.

### Middleware (`middleware.ts`)
- **Purpose:** Handles authentication protection and route guarding.
- **Logic:** Checks Supabase session, redirects unauthenticated users from `/portal`, handles role-based access control placeholders.

### Services (`app/services/`)
- **Purpose:** Encapsulates business logic and database interactions.
- **Files:** `technicianService.ts`, `appointmentService.ts`, `quoteService.ts`.

### Components (`components/`)
- **Purpose:** Reusable UI elements.
- **Location:** `Development/components`

## Data Flow

1.  **Authentication:** Users log in via Supabase Auth. Middleware validates session cookies.
2.  **Data Access:**
    -   **Server-side:** `createServerClient` in middleware and API routes.
    -   **Client-side:** Likely `createBrowserClient` (inferred) for interactive components.
3.  **External Services:**
    -   **Supabase:** Database and Auth.
    -   **Resend:** Email delivery (`api/resend-onboarding`).
    -   **Google Maps:** Mapping integration (`@react-google-maps/api`).

## Integration Points

| Service | Type | Purpose |
|---------|------|---------|
| Supabase | BaaS | Auth, Database, Storage |
| Resend | API | Transactional Emails |
| Google Maps | API | Location Services |

## Technical Debt

- [ ] `TODO` or `FIXME` items were not explicitly found in a shallow scan, but deep scan is recommended.
- [ ] Middleware has comments about role redirection complexity.

## Conventions

-   **Patterns:** Service layer pattern used in `app/services/*.ts`.
-   **Styling:** Tailwind CSS.
-   **Type Safety:** TypeScript used throughout.
